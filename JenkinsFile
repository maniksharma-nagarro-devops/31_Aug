pipeline {
    agent any
    
    
    stages {
	   
        stage("Code Build Using Maven"){
            steps{
            		withMaven(maven:'maven2'){
			sh 'mvn -f pom.xml install'
		}
            }
        }



	stage('Deploy to artifactory'){
		   steps{
		        rtUpload(
		            serverId: "artifactory-server",
		            spec: '''{
		                    "files":[
		                    {
		                        "pattern":"*.war",
		                        "target":"assignment"
		                     }
		                             ]
		            }'''
		        )
		   }
		}





        stage('Creating Docker Images') {
            steps{
                sh 'docker build -t manik_images_dev:latest .'
            }
        }

 

	stage('Run docker image'){
	    steps{
			sh "chmod +x -R ${env.WORKSPACE}"
			sh "./container_check.sh"
			sh 'docker run --name dev -p 9090:8080 manik_images_dev:latest'
			}
		}
    }

}
